#!/bin/bash

# Terminate already running bar instances
killall -q waybar

# Wait until the processes have been shut down
while pgrep -x waybar >/dev/null; do sleep 1; done

# Launch main
waybar -c $HOME/.config/sway/waybar/config -s $HOME/.config/sway/waybar/style.css

# Set autoreload
CONFIG_FILES="$HOME/.config/sway/waybar/config $HOME/.config/sway/waybar/style.css"
CONFIG="$HOME/.config/sway/waybar/config"
STYLE="$HOME/.config/sway/waybar/style.css"

trap "killall waybar" EXIT

while true; do
    waybar -c $CONFIG -s $STYLE &
    inotifywait -e create,modify $CONFIG_FILES
    killall waybar
done