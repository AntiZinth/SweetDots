#!/bin/bash

dir="$HOME/.config/sway/dunst/icons"

volume=$(amixer -D pulse get Master | grep '%' | head -n 1 | awk -F'[' '{print $2}' | awk -F'%' '{print $1}')

muted () {
  amixer -D pulse get Master | grep '%' | grep -oE '[^ ]+$' | grep off
}


send_notification () {

  if [[ "$volume" -lt "35" ]]; then
    icon="$dir/volume.svg"
  elif [[ "$volume" -lt "70" ]]; then
    icon="$dir/volume-1.svg"
  else
    icon="$dir/volume-2.svg"
  fi

  notify-send -i $icon "Volume : $volume"
}

docs () {
  echo "Usage: volume [Options]

  Options:
    up          increase the volume to 5% and sends a notification
    down        decrease the volume to 5% and send a notification
    mute        mute the volume and sends a notification"
}

case $1 in
  up)
	  amixer -D pulse set Master on > /dev/null
	  amixer -D pulse set Master 5%+ > /dev/null
    send_notification
    ;;
  down)
	  amixer -D pulse set Master on > /dev/null
	  amixer -D pulse set Master 5%- > /dev/null
    send_notification
    ;;
  mute)
	  amixer -D pulse set Master 1+ toggle > /dev/null
    if muted ; then
      icon="$dir/volume-x.svg"
      notify-send -i $icon "Mute"
    else
      send_notification
    fi
    ;;
  *)
    docs
    ;;
esac