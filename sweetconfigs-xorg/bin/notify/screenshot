#!/bin/bash

time=$(date +%Y-%m-%d-%I-%M-%S)
geometry=$(xrandr | head -n1 | cut -d',' -f2 | tr -d '[:blank:],current')
dir="$(xdg-user-dir PICTURES)/Screenshots"
file="Screenshot_${time}_${geometry}.png"

icon="$HOME/.config/sweetconfigs-xorg/dunst/icons/clock.svg"

notify_user () {
	notify-send -u normal -r 699 "Copied to clipboard."
	viewnior ${dir}/"$file"
	if [[ -e "$dir/$file" ]]; then
		notify-send -u normal -r 699 -i $dir/$file "Screenshot Saved"
	else
		notify-send -u normal -r 699 "Screenshot Deleted."
	fi
}

countdown () {
	for sec in `seq $1 -1 1`; do
		notify-send -t 1000 -r 699 -i $icon "Taking shot in : $sec"
		sleep 1
	done
}

shotnow () {
	cd ${dir} && scrot -q100 "$file" -e 'xclip -selection clipboard -t image/png -i $f'
	notify_user
}

shot5 () {
	countdown '5'
	sleep 1 && cd ${dir} && scrot -q100 "$file" -e 'xclip -selection clipboard -t image/png -i $f'
	notify_user
}

shot10 () {
	countdown '10'
	sleep 1 && cd ${dir} && scrot -q100 "$file" -e 'xclip -selection clipboard -t image/png -i $f'
	notify_user
}

shotwin () {
	cd ${dir} && scrot -q 100 -f -u "$file" -e 'xclip -selection clipboard -t image/png -i $f'
	notify_user
}

shotarea () {
	cd ${dir} && scrot -q100 -s -f -b "$file" -e 'xclip -selection clipboard -t image/png -i $f'
	notify_user
}

docs () {
	echo "
Usage:	screenshot [Options]
    
Options:
    now     -   Take screenshot of the desktop
    window  -   Take screenshot of the focused window
    area    -   Take screenshot of the selected area
    in5     -   Take screenshot in 5 seconds
    in10    -   Take screenshot in 10 seconds
	"
}

if [[ ! -d "$dir" ]]; then
	mkdir -p "$dir"
fi

case $1 in
    now)
	    shotnow
    ;;
    in5)
	    shot5
    ;;
    in10)
	    shot10
    ;;
	window)
        shotwin
    ;;
    area)
	    shotarea
    ;;
    *)
		docs
    ;;
esac

exit 0
